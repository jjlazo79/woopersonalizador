!function(r,e){var n={cache:function(){n.els={},n.vars={},n.tpl={},n.els.fields_table=r(".iconic-cffv-fields"),n.els.fields_table_body=n.els.fields_table.find("tbody"),n.tpl.field_editor_layout='<form class="iconic-cffv-field-editor"><h2>{{field_action}} Field</h2><p><label><strong>Field Label</strong></label><br><input type="text" class="large-text" value="{{label}}" name="label"></p><p><label><strong>Field ID</strong></label><br><input type="text" class="large-text" value="{{id}}" name="id" readonly></p><p><label><strong>Field Type</strong></label><br><select class="iconic-cffv-field-editor__type" name="type"><option value="text">Text</option><option value="textarea">Textarea</option><option value="select">Select</option><option value="checkboxes">Checkboxes</option><option value="radio_buttons">Radio Buttons</option></select></p><div class="iconic-cffv-placeholder--options"></div><p><label><strong>Field Description</strong></label><br><textarea class="large-text" rows="5" name="description">{{description}}</textarea></p><h3>Product Page Display Options</h3><p>Choose how the variation data is displayed on the frontend to the customer.</p><p><label><strong>Show on Frontend?</strong></label><br><select class="iconic-cffv-field-editor__display_frontend" name="display_frontend"><option value="yes">Yes</option><option value="no">No</option></select></p><p><label><strong>Show Label?</strong></label><br><select class="iconic-cffv-field-editor__display_label" name="display_label"><option value="yes">Yes</option><option value="no">No</option></select></p><div class="iconic-cffv-placeholder--display-as"></div><div class="iconic-cffv-placeholder--label-position"></div><a href="javascript: void(0);" class="button button-primary iconic-cffv-save-field" data-save-type="{{field_action}}" data-index="{{field_index}}">{{field_action}} Field</a></form>',n.tpl.field_row='<tr class="iconic-cffv-fields__field" data-index="{{index}}"><td><strong>{{order}}</strong><input type="hidden" class="iconic-cffv-field-data" name="iconic-cffv-field-data[{{index}}]" value="{{json}}"></td><td class="title column-title has-row-actions column-primary page-title"><strong><a href="#" class="row-title iconic-cffv-edit-field iconic-cffv-field-label">{{label}}</a></strong><div class="row-actions"><a href="javascript: void(0);" class="iconic-cffv-edit-field" title="Edit Field">Edit</a> |<span class="trash"><a href="javascript: void(0);" class="iconic-cffv-delete-field" title="Delete Field">Bin</a></span></div></td><td class="iconic-cffv-field-type">{{type}}</td></tr>',n.tpl.options='<div class="iconic-cffv-field-editor__options-wrapper"><strong>Field Options</strong><br>Enter each option on a new line.<br><textarea class="large-text iconic-cffv-field-editor__options" rows="5" name="options">{{options}}</textarea></div>',n.tpl.display_as='<p><label><strong>Display as</strong></label><br><select class="iconic-cffv-field-editor__display_as" name="display_as"><option value="list">List</option><option value="comma_separated">Comma Separated</option></select></p>',n.tpl.label_position='<p><label><strong>Label Position</strong></label><br><select class="iconic-cffv-field-editor__label_position" name="label_position"><option value="above">Above</option><option value="left">Left</option></select></p>'},on_ready:function(){n.cache(),n.setup_field_groups_edit_page(),n.setup_product_edit_page()},setup_field_groups_edit_page:function(){n.setup_field_editor()},setup_product_edit_page:function(){n.setup_help_tips()},setup_field_editor:function(){r(e).on("keyup",".iconic-cffv-field-editor [name='label']",function(){var e=r(this),i=e.val(),t=e.closest(".iconic-cffv-field-editor").find("[name='id']"),o=n.slugify(i);t.val(o)}),r(e).on("click",".iconic-cffv-edit-field",function(){var t=n.get_field_data_from_row(r(this)),o=null,e="",i="",l=!(!t||void 0===t.json.display_as)&&t.json.display_as;if(t){console.log(t),e=n.tpl.field_editor_layout.replace(/{{field_action}}/g,"Edit").replace("{{field_index}}",t.index).replace("{{label}}",t.json.label).replace("{{id}}",t.json.id).replace("{{description}}",n.br2nl(t.json.description)),t.json.options?i=n.tpl.options.replace("{{options}}",t.json.options):e=e.replace("{{options}}",""),o=r(e),n.has_display_as(t.json.type)&&n.add_to_placeholder("display-as",n.tpl.display_as,o),n.has_options(t.json.type)&&n.add_to_placeholder("options",i,o),n.has_label_position(t.json.type,l)&&n.add_to_placeholder("label-position",n.tpl.label_position,o);r.each(["type","display_frontend","display_label","label_position","display_as"],function(e,i){o.find('select[name="'+i+'"] option[value="'+t.json[i]+'"]').attr("selected",!0)})}else{var a=r(".iconic-cffv-fields__field").length;e=n.tpl.field_editor_layout.replace(/{{field_action}}/g,"Add").replace("{{field_index}}",a).replace("{{label}}","").replace("{{id}}","").replace("{{description}}",""),o=r(e),n.add_to_placeholder("label-position",n.tpl.label_position,o)}return e=o[0].outerHTML,r.magnificPopup.open({items:{src:'<div class="white-popup">'+e+"</div>",type:"inline"}},0),!1}),r(e).on("click",".iconic-cffv-save-field",function(){var e=parseInt(r(this).attr("data-index")),i=r(this).attr("data-save-type"),t=n.get_edit_field_data(),o=JSON.stringify(t),l=!1;return"Edit"===i?((l=r(".iconic-cffv-fields__field").eq(e)).find(".iconic-cffv-field-data").val(o),l.find(".iconic-cffv-field-label").html(t.label),l.find(".iconic-cffv-field-type").html(t.type)):((l=r(n.tpl.field_row.replace(/{{index}}/g,e).replace("{{order}}",e+1).replace("{{label}}",t.label).replace("{{type}}",t.type))).find(".iconic-cffv-field-data").val(o),n.els.fields_table_body.append(l)),r.magnificPopup.close(),!1}),r(e).on("change",".iconic-cffv-field-editor__type",function(){var e=r(this).closest(".iconic-cffv-field-editor"),i=r(this).val(),t=r(".iconic-cffv-field-editor__options");n.has_display_as(i)?n.add_to_placeholder("display-as",n.tpl.display_as,e):n.empty_placeholder("display-as",e),n.has_label_position(i)?n.add_to_placeholder("label-position",n.tpl.label_position,e):n.empty_placeholder("label-position",e),n.has_options(i)?t.length<=0&&n.add_to_placeholder("options",n.tpl.options.replace("{{options}}",""),e):n.empty_placeholder("options",e)}),r(e).on("change",".iconic-cffv-field-editor__display_as",function(){var e=r(this).closest(".iconic-cffv-field-editor");"comma_separated"===r(this).val()?n.add_to_placeholder("label-position",n.tpl.label_position,e):n.empty_placeholder("label-position",e)}),r(e).on("click",".iconic-cffv-delete-field",function(){r(this).closest("tr").remove(),n.update_field_orders()})},update_field_orders:function(){r(".iconic-cffv-fields__field-order").each(function(e,i){r(i).html(e+1)})},get_field_data_from_row:function(e){var i=e.closest("tr"),t=!1;if(i.length<=0)return t;var o=i.find(".iconic-cffv-field-data").val();return void 0===o||void 0===(t={index:i.attr("data-index"),json:r.parseJSON(o)}).json.id&&(t.json.id=n.slugify(t.json.label)),t},get_edit_field_data:function(){var e=r(".iconic-cffv-field-editor");return n.serialize_assoc(e)},serialize_assoc:function(e){var i=e.serializeArray(),t={};for(var o in i)if(i.hasOwnProperty(o)){var l=i[o].name.split(/\]|\[/);l=r.grep(l,function(e){return""!==e});var a=t;for(var n in l)if(l.hasOwnProperty(n)){var s=l[n],c={};parseInt(n)===l.length-1&&(c=i[o].value);var d={};d[s]=c,r.extend(!0,a,d),a=a[s]}}return t},nl2br:function(e,i){return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(i||void 0===i?"<br />":"<br>"))},br2nl:function(e){return(e+"").replace(/<br \/>/g,"\r\n")},slugify:function(e){e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var i="àáäâèéëêìíïîòóöôùúüûñç·/,:;",t=0,o=i.length;t<o;t++)e=e.replace(new RegExp(i.charAt(t),"g"),"aaaaeeeeiiiioooouuuunc_____".charAt(t));return e=e.replace(/[^a-z0-9 -_.]/g,"").replace(/\s+/g,"_").replace(/\.+/g,"_").replace(/-+/g,"_").replace(/_+/g,"_")},add_to_placeholder:function(e,i,t){t.find(".iconic-cffv-placeholder--"+e).html(i)},empty_placeholder:function(e,i){i.find(".iconic-cffv-placeholder--"+e).html("")},has_options:function(e){return"checkboxes"===e||"radio_buttons"===e||"select"===e},has_display_as:function(e){return"checkboxes"===e},has_label_position:function(e,i){return i=void 0!==i&&i,"text"===e||"radio_buttons"===e||"select"===e||"checkboxes"===e&&"comma_separated"===i},setup_help_tips:function(){r(e.body).on("wc-enhanced-select-init",function(){var e=r(".iconic-cffv-field-groups .woocommerce-help-tip");e.length<=0||e.each(function(){var e=r(this).closest(".form-row"),i=e.find("legend"),t=i.length<=0?e.find("label:first"):i;t.length<=0||t.append(r(this))})})}};r(e).ready(n.on_ready())}(jQuery,document);